<!doctype html><html lang=en><meta charset=utf-8><title>Facebook puzzle - Find Sophie - CTO AdTech, London</title><link href=//yui.yahooapis.com/pure/0.5.0/pure-min.css rel=stylesheet><link href=http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css rel=stylesheet><link href=/stylesheet.css rel=stylesheet><link href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,700" rel=stylesheet type=text/css><link href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css rel=stylesheet><script src=//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js></script><meta content="nanoc 4.0.0" name=generator><meta content="width=device-width, initial-scale=1.0" name=viewport><body onload=prettyPrint()><div id=container><div class="pure-menu pure-menu-open pure-menu-horizontal" id=navbar><a class=pure-menu-heading href=/>Pravin Paratey</a><ul class=pure-menu-list><li class=pure-menu-item><a href=/posts>Archives</a><li class=pure-menu-item><a href=https://github.com/pravin>Github</a><li class=pure-menu-item><a href=/about>About</a></ul></div><div id=blurb>Hello, I am an Engineering Manager at Facebook with 13+ years in Ad Technology, Natural Language Processing and Data mining. (<a href=/about>Learn More</a>)</div><div class=pure-g><div class="pure-u-1 pure-u-md-3-4 pure-u-sm-1" id=content><div class=pad><div class=date><time pubdate>September 28, 2010</time> <span class=author>by Pravin Paratey</span></div><article><h1>Facebook puzzle - Find Sophie</h1><p>Today, we’ll take a look at solving the Facebook engineering puzzle - <a href="http://www.facebook.com/careers/puzzles.php?puzzle_id=11">Find Sophie</a>.<h2 id=problem-statement>Problem statement</h2><p><img alt="Sophie the Cat" class=pure-img src=/img/posts/cat.svg><blockquote><p>After a long day of coding, you love to head home and relax with a loved one. Since that whole relationship thing hasn’t been working out for you recently, that loved one will have to be your cat, Sophie. Unfortunately you find yourself spending considerable time after you arrive home just trying to find her. Being a perfectionist and unable to let anything suboptimal be a part of your daily life, you decide to devise the most efficient possible method for finding Sophie.</blockquote><blockquote><p>Luckily for you, Sophie is a creature of habit. You know where all of her hiding places are, as well as the probability of her hiding in each one. You also know how long it takes you to walk from hiding place to hiding place. Write a program to determine the minimum expected time it will take to find Sophie in your apartment. It is sufficient to simply visit a location to check if Sophie is hiding there; no time must be spent looking for her at a location. Sophie is hiding when you enter your apartment, and then will not leave that hiding place until you find her. Your program must take the name of an input file as an argument on the command line.</blockquote><h2 id=understanding-the-problem>Understanding the problem</h2><p>This problem can be re-stated as - Given an undirected, weighted and possibly disconnected graph, find the “shortest” tour connecting all vertices which have a probability &gt; 0.<p>In short, we have to,<ul><li>Enumerate all paths starting from the first position.<li>Compute the Expectation value of each path.<li>Output the minimum. Or <code>-1.00</code> if we couldn’t cover all vertices.</ul><p>Lets work this out for the test input,<pre><code>4
front_door    .2
in_cabinet    .3
under_bed     .4
behind_blinds .1
5
front_door under_bed     5
under_bed  behind_blinds 9
front_door behind_blinds 5
front_door in_cabinet    2
in_cabinet behind_blinds 6
</code></pre><p>We can draw the graph as:<p><img alt="Graph of the example" class=pure-img src=/img/posts/sophie-1.svg><p>Our possible paths are:<ul><li><code>FD -&gt; UB -&gt; BB -&gt; IC</code><li><code>FD -&gt; UB -&gt; IC (via FD) -&gt; BB</code><li><code>FD -&gt; IC -&gt; UB (via FD) -&gt; BB</code><li><code>FD -&gt; IC -&gt; BB -&gt; UC</code><li>And so on</ul><h3 id=expectation-value>Expectation value</h3><p>You may recall from probability theory that for a discrete random variable <em>X</em> with a probability mass function <em>p(x)</em>, the expectation value is,<blockquote><p>E(X) = Σ x<sub>i</sub> ⋅ p(x<sub>i</sub>)</blockquote><p>In our problem, we have to find the expectation value (EV) of <strong>time taken</strong>. For the path, <code>FD -&gt; UB -&gt; BB -&gt; IC</code>, the EV will be (note how the time is additive):<blockquote><p>E(P<sub>1</sub>) = 0.2(0) + 0.4(5) + 0.1(5 + 9) + 0.3(5 + 9 + 6) = 9.40</blockquote><p>If you compute the EV for every path enumerated, you’ll find that the path with the least expectation value is <code>FD -&gt; IC -&gt; UB (via FD) -&gt; BB</code> [ 0.2(0) + 0.3(2) + 0.4(9) + 0.1(18) ]<h3 id=finding-tours>Finding tours</h3><p>Now that you know how to compute the EV of a path, the next challenge is figuring out how to find a path. We call this path a “tour” to indicate our intention to visit every node.<p>If you’ve studied Computer Science, you might think - <em>“<a href=http://en.wikipedia.org/wiki/Travelling_salesman_problem>Travelling Salesman!</a>“</em>. Umm … we don’t have the constraint of visiting each location <strong>exactly</strong> once. Which is a good thing or it’d be <a href=http://en.wikipedia.org/wiki/NP-complete>NP-complete</a>.<p>We’re going to do this in two stages. In the first stage, we will solve the <a href=http://en.wikipedia.org/wiki/Shortest_path_problem>shortest path problem</a> for all pairs of vertices. We can use either <a href=http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm>Dijkstra’s algorithm</a>, <a href=http://en.wikipedia.org/wiki/Floyd-Warshall_algorithm>Floyd-Warshall algorithm</a> or <a href=http://en.wikipedia.org/wiki/Johnson%27s_algorithm>Johnson’s algorithm</a> (which is faster than Floyd-Warshall in certain cases).<p>The shortest path algorithms described above tell you the shortest-path between two nodes. The next stage is enumerating all possible tours. This has a possible time complexity between O(n<sup>n</sup>) and O(n!) depending on your implementation.<p>At this point, you’re ready to compute the EV of every tour and output the minimum.<h3 id=optimizing>Optimizing</h3><p>Of course, that’s slow. And it wouldn’t pass the Facebook PuzzleBot. So what do you do? How do you make it faster? I’m not sure about faster, but we can definitely make it our algorithm smarter.<p>The O(n!) is the culprit. Do you really need to enumerate all possibilities? Or can you discard the unviable paths? How do you know a branch is unviable?<p>The first thing you can do is store the minimum EV (until now) and discard all paths that exceed this value. Consider the following figure. Assume the EV of the first path <code>[FD -&gt; UB -&gt; BB -&gt; IC]</code> was 100. If the EV of <code>[FD -&gt; IC]</code> is &gt; 100, we can drop the entire branch (colored Red).<p><img alt="Dropping branches based on score" class=pure-img src=/img/posts/sophie-2.svg><p>If you add this to your code and run it, you’ll realize that you don’t end up dropping as many branches as you’d like. Can we do better?<p>Well, Yes. What if you used a heuristic like that in A* algorithm to compute the EV of the remaining path? Since we are looking for an exact solution and not an approximate one, our heuristic <em>h(x)</em> should be chosen carefully. <em>h(x)</em> should always be &lt;= the min(E(Path<sub>i</sub>)). One possible <em>h(x)</em> can be:<blockquote><p>h(x) = min(Path_length) * (Remaining Probability)</blockquote><h3 id=congratulations>Congratulations</h3><p>This is enough to get past the PuzzleBot. I leave you with a final question: Can you do better? Perhaps at the cost of memory? I look forward to your comments<h2 id=updates>Updates</h2><dl><dt>February 05, 2011<dd>Since many of you have asked me how much time my code took to run the examples, I’ve updated <a href=https://github.com/pravin/Public-Domain/tree/master/finding-sophie>results.txt</a> with the time. Oh, and my machine has a 2.4GHz dual core processor.</dl><h2 id=resources>Resources</h2><dl><dt>Download<dd>⋅ <a href=https://github.com/pravin/Public-Domain/tree/master/finding-sophie>Test cases</a><dt>Books<dd>⋅ <a href="http://www.amazon.com/gp/product/0262033844?ie=UTF8&amp;tag=insanbegin-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0262033844">Introduction to Algorithms</a><dd>⋅ <a href="http://www.amazon.com/gp/product/1155434854?ie=UTF8&amp;tag=insanbegin-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=1155434854">Computational Problems in Graph Theory: Travelling Salesman Problem, Shortest Path Problem, Hamiltonian Path Problem, Hamiltonian Path</a><dd>⋅ <a href="http://www.amazon.com/gp/product/0521288819?ie=UTF8&amp;tag=insanbegin-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0521288819">Algorithmic Graph Theory</a><dt>Paper<dd>⋅ <a href=https://github.com/pravin/Public-Domain/blob/master/finding-sophie/bellman58routing.pdf>On a routing problem (Richard Bellman)</a></dl></article></div></div><div class="pure-u-1 pure-u-md-1-4 pure-u-sm-1" id=sidebar><div class=pad><div class=share><div class=g-plusone></div></div><a name=contact></a><h3>Get in touch</h3><div style=text-align:center><a href=mailto:pravinp@gmail.com title="Email Pravin"><i class="fa fa-5x fa-envelope-o sc"></i></a> <br> <a href=/pravin_paratey.pub title="PGP public key"><i class="fa fa-key sc"></i></a> <a href=/pravin_paratey.asc title="RSA Fingerprint"><i class="fa fa-barcode sc"></i></a> <br> <a href=https://www.facebook.com/pravin.paratey title=Facebook><i class="fa fa-2x fa-facebook-square sc"></i></a> <a href=https://github.com/pravin title=Github><i class="fa fa-2x fa-github sc"></i></a> <a href=http://twitter.com/pravin title=@pravin><i class="fa fa-2x fa-twitter sc"></i></a> <a href=http://uk.linkedin.com/in/pravinp title="Linked In"><i class="fa fa-2x fa-linkedin sc"></i></a> <a href=https://www.medium.com/@pravin title=Medium><i class="fa fa-2x fa-medium sc"></i></a></div><h3>Advert</h3><div id=advert><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle data-ad-client=ca-pub-5089148546380783 data-ad-slot=4508934025 style=display:inline-block;width:300px;height:250px></ins> <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script></div><a name=sidebar></a><h3>Latest Articles</h3><div class="pure-menu pure-menu-open"><ul class=pure-menu-list><li class=pure-menu-item><a href=/posts/53-what-i-look-for-in-my-hires/>What I look for in my hires<br> <small>In here, I discuss the 7 qualities I look for in my hires - Predictability, Empathy, Autonomy, Adaptability, Growth potential, Ownership and Problem solving.</small> </a><li class=pure-menu-item><a href=/posts/hiring-developers/>What I learnt about hiring<br> <small>During the last year, Affectv has experienced rapid growth. We have doubled the engineering team in the last 8 months. This is a compilation of some of the things I learnt about the hiring process.</small> </a><li class=pure-menu-item><a href=/posts/cookie-mapping-advertising/>Cookie Mapping in Advertising<br> <small>In this article, we will cover the process of cookie mapping (or cookie syncing) and how advertising companies use it to exchange information with websites and advertising platforms to serve relevant advertising to a user.</small> </a><li class=pure-menu-item><a href=/posts/building-url-shortener/>Building a url shortener in 10 mins<br> <small>A 10 minute guide to building your own url shortener i.e. a service that lets you shorten a long url to a shorter url that takes up less number of characters.</small> </a><li class=pure-menu-item><a href=/posts/apache-pig-tutorial/>Apache Pig Tutorial<br> <small>An unofficial Apache Pig tutorial for the beginning and intermediate user which covers the basics of Pig and moves on to the more advanced concepts.</small> </a><li class=pure-menu-item><a href=/posts/summarization/>Summarisation Demo<br> <small>Working demo of a summarization module I wrote a few years ago. This webapp lets you create summaries of large pieces of text.</small> </a><li class=pure-menu-item><a href=/posts/going-textmode/>Going Text-mode<br> <small>I spend a great deal of time working on the Terminal. Here, I list my must-have console applications for email, www browsing, and programming in Linux, Windows and Mac OSX.</small> </a><li class=pure-menu-item><a href=/posts/setting-up-replica-sets-in-mongodb/>Setting up Replica sets in MongoDB<br> <small>A 5-minute guide to setting up replica sets on MongoDB. Covers downloading, installation on various flavours of linux, editing the config file and initiating replica sets!</small> </a><li class=pure-menu-item><a href=/posts/super-quick-find-replace/>Super quick Find &amp; Replace<br> <small>This article explores a number of ways of performing a find/replace and compares the various implementations for different sizes of the find/replace list and input text.</small> </a><li class=pure-menu-item><a href=/posts/set-data-structures-and-implementation/>Set data structures &amp; Implementation<br> <small>Sets are an important concept and extremely useful in various computer science applications. We take a look at some of the ways a set data structure can be implemented.</small> </a></ul></div></div></div></div><div class=pure-g><footer class="pure-u-1 pure-u-md-1 pure-u-sm-1">This page and its contents are copyright © 1998 - 2016, <a href>Pravin Paratey</a>. <a href=https://plus.google.com/u/1/116027419623187923256 rel=author>G+</a></footer> <script src=/js/prettify.js></script> <script type=text/javascript>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-263738-3', 'auto');
	    ga('send', 'pageview');

        /* Social buttons */
        $('img.sc').hover (
          function () {
            $(this).attr('src', $(this).attr('src').replace('_dark', '_active'));
          },
          function () {
            $(this).attr('src', $(this).attr('src').replace('_active', '_dark'));
          }
        );

        /* Place this tag after the last +1 button tag. */
        (function() {
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
          po.src = 'https://apis.google.com/js/plusone.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
      </script></div><div></div></div>