<!doctype html><html lang=en><meta charset=utf-8><title>Cookie Mapping in Advertising - CTO AdTech, London</title><link href=//yui.yahooapis.com/pure/0.5.0/pure-min.css rel=stylesheet><link href=http://yui.yahooapis.com/pure/0.6.0/grids-responsive-min.css rel=stylesheet><link href=/stylesheet.css rel=stylesheet><link href="//fonts.googleapis.com/css?family=Merriweather:300,300italic,700" rel=stylesheet type=text/css><link href=//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css rel=stylesheet><script src=//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js></script><meta content="nanoc 4.0.0" name=generator><meta content="width=device-width, initial-scale=1.0" name=viewport><body onload=prettyPrint()><div id=container><div class="pure-menu pure-menu-open pure-menu-horizontal" id=navbar><a class=pure-menu-heading href=/>Pravin Paratey</a><ul class=pure-menu-list><li class=pure-menu-item><a href=/posts>Archives</a><li class=pure-menu-item><a href=https://github.com/pravin>Github</a><li class=pure-menu-item><a href=/about>About</a></ul></div><div id=blurb>Hello, I am an Engineering Manager at Facebook with 13+ years in Ad Technology, Natural Language Processing and Data mining. (<a href=/about>Learn More</a>)</div><div class=pure-g><div class="pure-u-1 pure-u-md-3-4 pure-u-sm-1" id=content><div class=pad><div class=date><time pubdate>June 16, 2013</time> <span class=author>by Pravin Paratey</span></div><article><h1>Cookie Mapping in Advertising</h1><p>Picture your daily activities on the internet. You search for things, you browse some news articles - perhaps commenting on a few; you watch a few videos - perhaps liking a couple and you post to your favourite social network.<p>Everything you do online leaves a trail on the websites you visit or on the tools you interact with. This data is invaluable to advertisers who build extremely complex models to understand you and to predict what products or services you would be interested in at any point in time.<p><img alt="Milk n Cookie" class=pure-img src=/img/posts/milk-cookie.jpg><p>However, this data is heavily partitioned into silos. In most cases, the only way of identifying you is by storing an identifier in the browser cookie. This identifier is typically a string of randomly generated characters which is unique to you. Every time you visit a page on that website, your identifier is read from the cookie and the website stores your visit to that url in their logs.<p>Advertising companies partner with websites to access their log level data. However, there is a caveat. There is <strong>no way</strong> of telling who user <code>123</code> on that website is on the advertisers system. Cookie mapping is a process with which this information can be shared.<h2 id=if-that-didnt-make-sense>If that didn’t make sense</h2><p>Let me give you an example to illustrate what I just said. Let’s assume all you do in a day is visit your local store and the cinema.<p><img alt="Visiting a shop" class="pull-right pure-img" src=/img/posts/shop.png><p>The local store knows a fair bit about you. It has an itemised list of food you buy and how much you spend. Your cinema knows the kind of films you watch and what popcorn and soft drink you enjoy. For an advertiser, this is data that it can use to build a profile on you.<p>Remember the caveat I mentioned earlier? Neither the store, the cinema or the advertiser know your name. They can’t ask you for your real name because you will be uncomfortable revealing that information and may choose not to shop at their store! So they store stuff about you under a pseudonym. The owner of the store calls you “the cute redhead” and files their copy of the receipt in a folder. The ticketmaster at the movies notes the movies you watch under the name “red shoes” while the advertiser calls you “customer 29”.<p><a class="pull-right pure-img" href=/img/posts/movies.png>Going to the movies</a><p>Now, although each party has bits of information about you, the information is partitioned. The owner of the store only knows what you have done in their store. The ticketmaster at the movies only knows the kind of movies you watch and the beverages you consumed. While the advertiser has no way of knowing that “customer 29” is the same as “red shoes” and “the cute redhead”. Without this crucial piece of information, all the data from the store and the cinema is worthless to the advertiser!<p>To solve this, the advertiser comes up with an innovative way. He employs a bunch of errand boys who stand with a notepad at the store and the cinema. Now, every time a new customer is named with a pseudonym, the errand boys look up their notepad and write that pseudonym against their customer id. At the end of the day, when the advertiser picks up the folder from the store owner and the ticketmaster, he can match the pseudonyms against his own customer list using the errand boys’ notepad.<h2 id=back-to-where-we-were>Back to where we were</h2><p>So coming back, although an advertiser has access to log level data from all the websites he works with, the data is no good without a way of <strong>mapping</strong> their cookie ids to his own.<p>The job of the errand boy is done by a process called Cookie mapping or Cookie syncing. This enables the advertiser to track a user across several websites and internet tools.<h2 id=how>How</h2><p><img alt="Visiting a shop" class="pull-right pure-img" src=/img/posts/cookie-mapping.png><p>So how does this process actually work? When you vist a website, there is a tiny pixel down on the page called a mapping pixel. For this example assume this is an image pixel of the form <code>http://website.com/1x1.gif</code>. Do note that at the backend, the 1x1.gif is <strong>NOT</strong> a static image but a script that looks like,<pre class="prettyprint linenums:1"><code class=language-php>&lt;?php
$user_id = $_COOKIE['user_id']; // Read the user cookie
// Set the user_id in the advertiser url
$advertiser_url = "http://advertiser.com/map?user_id=$user_id";
header("Location: $advertiser_url"); // Mapping call (302 redirect) to the advertiser 
?&gt;
</code></pre><p>When the browser tries to get the image pixel resource, the php code redirects the browser to the advertisers’ server. A script on the advertisers’ server reads the <code>user_id</code> from the user_id parameter and stores the mapping in a database using a script like,<pre class="prettyprint linenums:1"><code class=language-php>&lt;?php
// Read the user cookie. This is the cookie id set by the advertiser
// It is different from the user_id above
$user_id = $_COOKIE['user_id']; 
$website_id = $_GET['user_id']; // Get the website's user id from the URL.

// Store the $user_id and $website_id in the database
store_mapping($user_id, $website_id);

header("Location: http://advertiser.com/1x1.gif"); // 302 redirect to a 1x1 image pixel
// Alternatively, just return the 1x1 pixel here.
?&gt;
</code></pre><p>Now, at the end of the day when the advertiser receives log files from <strong>website.com</strong>, he can use the mapping table in the database to translate website user_ids into advertisers’ user_ids.<p>And that folks, is the how and the why of mapping calls.</article></div></div><div class="pure-u-1 pure-u-md-1-4 pure-u-sm-1" id=sidebar><div class=pad><div class=share><div class=g-plusone></div></div><a name=contact></a><h3>Get in touch</h3><div style=text-align:center><a href=mailto:pravinp@gmail.com title="Email Pravin"><i class="fa fa-5x fa-envelope-o sc"></i></a> <br> <a href=/pravin_paratey.pub title="PGP public key"><i class="fa fa-key sc"></i></a> <a href=/pravin_paratey.asc title="RSA Fingerprint"><i class="fa fa-barcode sc"></i></a> <br> <a href=https://www.facebook.com/pravin.paratey title=Facebook><i class="fa fa-2x fa-facebook-square sc"></i></a> <a href=https://github.com/pravin title=Github><i class="fa fa-2x fa-github sc"></i></a> <a href=http://twitter.com/pravin title=@pravin><i class="fa fa-2x fa-twitter sc"></i></a> <a href=http://uk.linkedin.com/in/pravinp title="Linked In"><i class="fa fa-2x fa-linkedin sc"></i></a> <a href=https://www.medium.com/@pravin title=Medium><i class="fa fa-2x fa-medium sc"></i></a></div><h3>Advert</h3><div id=advert><script async src=//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script> <ins class=adsbygoogle data-ad-client=ca-pub-5089148546380783 data-ad-slot=4508934025 style=display:inline-block;width:300px;height:250px></ins> <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
            </script></div><a name=sidebar></a><h3>Latest Articles</h3><div class="pure-menu pure-menu-open"><ul class=pure-menu-list><li class=pure-menu-item><a href=/posts/53-what-i-look-for-in-my-hires/>What I look for in my hires<br> <small>In here, I discuss the 7 qualities I look for in my hires - Predictability, Empathy, Autonomy, Adaptability, Growth potential, Ownership and Problem solving.</small> </a><li class=pure-menu-item><a href=/posts/hiring-developers/>What I learnt about hiring<br> <small>During the last year, Affectv has experienced rapid growth. We have doubled the engineering team in the last 8 months. This is a compilation of some of the things I learnt about the hiring process.</small> </a><li class=pure-menu-item><a href=/posts/cookie-mapping-advertising/>Cookie Mapping in Advertising<br> <small>In this article, we will cover the process of cookie mapping (or cookie syncing) and how advertising companies use it to exchange information with websites and advertising platforms to serve relevant advertising to a user.</small> </a><li class=pure-menu-item><a href=/posts/building-url-shortener/>Building a url shortener in 10 mins<br> <small>A 10 minute guide to building your own url shortener i.e. a service that lets you shorten a long url to a shorter url that takes up less number of characters.</small> </a><li class=pure-menu-item><a href=/posts/apache-pig-tutorial/>Apache Pig Tutorial<br> <small>An unofficial Apache Pig tutorial for the beginning and intermediate user which covers the basics of Pig and moves on to the more advanced concepts.</small> </a><li class=pure-menu-item><a href=/posts/summarization/>Summarisation Demo<br> <small>Working demo of a summarization module I wrote a few years ago. This webapp lets you create summaries of large pieces of text.</small> </a><li class=pure-menu-item><a href=/posts/going-textmode/>Going Text-mode<br> <small>I spend a great deal of time working on the Terminal. Here, I list my must-have console applications for email, www browsing, and programming in Linux, Windows and Mac OSX.</small> </a><li class=pure-menu-item><a href=/posts/setting-up-replica-sets-in-mongodb/>Setting up Replica sets in MongoDB<br> <small>A 5-minute guide to setting up replica sets on MongoDB. Covers downloading, installation on various flavours of linux, editing the config file and initiating replica sets!</small> </a><li class=pure-menu-item><a href=/posts/super-quick-find-replace/>Super quick Find &amp; Replace<br> <small>This article explores a number of ways of performing a find/replace and compares the various implementations for different sizes of the find/replace list and input text.</small> </a><li class=pure-menu-item><a href=/posts/set-data-structures-and-implementation/>Set data structures &amp; Implementation<br> <small>Sets are an important concept and extremely useful in various computer science applications. We take a look at some of the ways a set data structure can be implemented.</small> </a></ul></div></div></div></div><div class=pure-g><footer class="pure-u-1 pure-u-md-1 pure-u-sm-1">This page and its contents are copyright © 1998 - 2016, <a href>Pravin Paratey</a>. <a href=https://plus.google.com/u/1/116027419623187923256 rel=author>G+</a></footer> <script src=/js/prettify.js></script> <script type=text/javascript>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-263738-3', 'auto');
	    ga('send', 'pageview');

        /* Social buttons */
        $('img.sc').hover (
          function () {
            $(this).attr('src', $(this).attr('src').replace('_dark', '_active'));
          },
          function () {
            $(this).attr('src', $(this).attr('src').replace('_active', '_dark'));
          }
        );

        /* Place this tag after the last +1 button tag. */
        (function() {
          var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
          po.src = 'https://apis.google.com/js/plusone.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
        })();
      </script></div><div></div></div>